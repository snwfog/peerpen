(function(f,d){f.fn.simulate=function(m,l){switch(m){case"drag":case"drop":case"drag-n-drop":var n=this.first();new f.simulate(n[0],m,l);return n;default:return this.each(function(){new f.simulate(this,m,l)})}};var b=Date.now||function(){return new Date().getTime()};var k=/\[object (?:HTML)?Document\]/;function e(l){return k.test(Object.prototype.toString.call(f(l)[0]))}function h(n,l){var m;if(f.isFunction(l)){for(m=0;m<n.length;m+=1){if(l(n[m])){return n[m]}}return null}else{for(m=0;m<n.length;m+=1){if(n[m]){return n[m]}}return null}}function i(l){var m;l=f(l);if(e(l[0])){m={left:0,top:0}}else{m=l.offset()}return{x:m.left+l.outerWidth()/2,y:m.top+l.outerHeight()/2}}function a(l,o,m){var n;if(e(o)){n=f(o)}else{n=f(m||document)}if(typeof l==="number"&&typeof o==="number"){return{x:l-n.scrollLeft(),y:o-n.scrollTop()}}else{if(typeof l==="object"&&l.pageX&&l.pageY){return{clientX:l.pageX-n.scrollLeft(),clientY:l.pageY-n.scrollTop()}}}}function j(m,s,n){var r;if(e(s)){r=s}else{r=n||document}if(!r.elementFromPoint){return null}var p=m,o=s;if(typeof m==="object"&&(m.clientX||m.clientY)){p=m.clientX||0;o=m.clientY||0}if(j.prototype.check){var l,q;if((l=f(r).scrollTop())>0){q=r.elementFromPoint(0,l+f(window).height()-1);if(q!==null&&q.tagName.toUpperCase()==="HTML"){q=null}j.prototype.nativeUsesRelative=(q===null)}else{if((l=f(r).scrollLeft())>0){q=r.elementFromPoint(l+f(window).width()-1,0);if(q!==null&&q.tagName.toUpperCase()==="HTML"){q=null}j.prototype.nativeUsesRelative=(q===null)}}j.prototype.check=(l<=0)}if(!j.prototype.nativeUsesRelative){p+=f(r).scrollLeft();o+=f(r).scrollTop()}return r.elementFromPoint(p,o)}j.prototype.check=true;j.prototype.nativeUsesRelative=true;function c(n,l){var m=l||{};f(n).trigger({type:"simulate-drag"});if(f.isFunction(m.callback)){m.callback.apply(n)}}function g(u,r,o,A,n){var C=h([r,r.ownerDocument],e)||document,s=n.interpolation,G=Math.sqrt(Math.pow(A.dx,2)+Math.pow(A.dy,2)),q,l,t;if(s.stepWidth){q=parseInt(s.stepWidth,10);l=Math.floor(G/q)-1;var x=q/G;t={x:A.dx*x,y:A.dy*x}}else{l=parseInt(s.stepCount,10);q=G/(l+1);t={x:A.dx/(l+1),y:A.dy/(l+1)}}var y=f.extend({},o);function v(){y.x+=t.x;y.y+=t.y;var H={pageX:y.x,pageY:y.y};if(s.shaky&&(s.shaky===true||!isNaN(parseInt(s.shaky,10)))){var J=(s.shaky===true)?1:parseInt(s.shaky,10);H.pageX+=Math.floor(Math.random()*(2*J+1)-J);H.pageY+=Math.floor(Math.random()*(2*J+1)-J)}var I=a(H,C),K=j(I,C)||r;u.simulateEvent(K,"mousemove",{pageX:Math.round(H.pageX),pageY:Math.round(H.pageY)})}var E;function D(){var I=b()-E;if(I>=w){if(p<l){v();p+=1;E=b();setTimeout(D,w)}else{var J={pageX:Math.round(o.x+A.dx),pageY:Math.round(o.y+A.dy)},H=a(J,C),K=j(H,C)||r;u.simulateEvent(K,"mousemove",J);c(r,n)}}else{setTimeout(D,w-I)}}if((!s.stepDelay&&!s.duration)||((s.stepDelay<=0)&&(s.duration<=0))){for(var z=0;z<l;z+=1){v()}var F={pageX:Math.round(o.x+A.dx),pageY:Math.round(o.y+A.dy)},B=a(F,C),m=j(B,C)||r;u.simulateEvent(m,"mousemove",F);c(r,n)}else{var w=parseInt(s.stepDelay,10)||Math.ceil(parseInt(s.duration,10)/(l+1));var p=0;E=b();setTimeout(D,w)}}f.simulate.activeDrag=function(){if(!f.simulate._activeDrag){return d}return f.extend(true,{},f.simulate._activeDrag)};f.extend(f.simulate.prototype,{simulateDrag:function(){var u=this,z=u.target,A=f.extend({dx:0,dy:0,dragTarget:d,clickToDrag:false,interpolation:{stepWidth:0,stepCount:0,stepDelay:0,duration:0,shaky:false},callback:d},this.options);var l,p=(f.simulate._activeDrag&&f.simulate._activeDrag.dragElement===z);if(p){l=f.simulate._activeDrag.dragStart}else{l=i(z)}var r=Math.round(l.x),q=Math.round(l.y),o={pageX:r,pageY:q},w,t;if(A.dragTarget){var n=i(A.dragTarget);w=Math.round(n.x-l.x);t=Math.round(n.y-l.y)}else{w=A.dx||0;t=A.dy||0}if(p){f.simulate._activeDrag.dragDistance.x+=w;f.simulate._activeDrag.dragDistance.y+=t;o={pageX:Math.round(r+f.simulate._activeDrag.dragDistance.x),pageY:Math.round(q+f.simulate._activeDrag.dragDistance.y)}}else{if(f.simulate._activeDrag){f(f.simulate._activeDrag.dragElement).simulate("drop")}u.simulateEvent(z,"mousedown",o);if(A.clickToDrag===true){u.simulateEvent(z,"mouseup",o);u.simulateEvent(z,"click",o)}f(z).add(z.ownerDocument).one("mouseup",function(){f.simulate._activeDrag=d});f.extend(f.simulate,{_activeDrag:{dragElement:z,dragStart:{x:r,y:q},dragDistance:{x:w,y:t}}});o={pageX:Math.round(r+w),pageY:Math.round(q+t)}}if(w!==0||t!==0){if(A.interpolation&&(A.interpolation.stepCount||A.interpolation.stepWidth)){g(u,z,{x:r,y:q},{dx:w,dy:t},A)}else{var v=h([z,z.ownerDocument],e)||document,m=a(o,v),s=j(m,v)||z;u.simulateEvent(s,"mousemove",o);c(z,A)}}else{c(z,A)}},simulateDrop:function(){var t=this,v=this.target,s=f.simulate._activeDrag,w=f.extend({clickToDrop:false,callback:d},t.options),m=true,l=i(v),q=Math.round(l.x),p=Math.round(l.y),o={pageX:q,pageY:p},u=((s)?h([s.dragElement,s.dragElement.ownerDocument],e):h([v,v.ownerDocument],e))||document,n=a(o,u),r=j(n,u);if(s&&(s.dragElement===v||e(v))){q=Math.round(s.dragStart.x+s.dragDistance.x);p=Math.round(s.dragStart.y+s.dragDistance.y);o={pageX:q,pageY:p};n=a(o,u);r=j(n,u);m=false}if(!r){r=(s)?s.dragElement:v}if(m===true){t.simulateEvent(r,"mousemove",o)}if(w.clickToDrop){t.simulateEvent(r,"mousedown",o)}this.simulateEvent(r,"mouseup",o);if(w.clickToDrop){t.simulateEvent(r,"click",o)}f.simulate._activeDrag=d;f(r).trigger({type:"simulate-drop"});if(f.isFunction(w.callback)){w.callback.apply(r)}},simulateDragNDrop:function(){var l=this,n=this.target,m=f.extend({dragTarget:d,dropTarget:d},l.options),o=((m.dragTarget||m.dx||m.dy)?m.dropTarget:n)||n;f(n).simulate("drag",f.extend({},m,{dragTarget:m.dragTarget||((m.dx||m.dy)?d:m.dropTarget),callback:function(){f(o).simulate("drop",m)}}))}})}(jQuery));