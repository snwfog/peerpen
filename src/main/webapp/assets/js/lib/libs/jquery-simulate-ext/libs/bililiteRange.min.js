(function(){bililiteRange=function(s,q){var r;if(q){r=new d()}else{if(document.selection){r=new a()}else{if(window.getSelection&&s.setSelectionRange){r=new l()}else{if(window.getSelection){r=new k()}else{r=new d()}}}}r._el=s;r._textProp=b(s);r._bounds=[0,r.length()];return r};function b(q){if(typeof q.value!="undefined"){return"value"}if(typeof q.text!="undefined"){return"text"}if(typeof q.textContent!="undefined"){return"textContent"}return"innerText"}function e(){}e.prototype={length:function(){return this._el[this._textProp].replace(/\r/g,"").length},bounds:function(r){if(r==="all"){this._bounds=[0,this.length()]}else{if(r==="start"){this._bounds=[0,0]}else{if(r==="end"){this._bounds=[this.length(),this.length()]}else{if(r==="selection"){this.bounds("all");this._bounds=this._nativeSelection()}else{if(r){this._bounds=r}else{var q=[Math.max(0,Math.min(this.length(),this._bounds[0])),Math.max(0,Math.min(this.length(),this._bounds[1]))];return q}}}}}return this},select:function(){this._nativeSelect(this._nativeRange(this.bounds()));return this},text:function(r,q){if(arguments.length){this._nativeSetText(r,this._nativeRange(this.bounds()));if(q=="start"){this.bounds([this._bounds[0],this._bounds[0]]);this.select()}else{if(q=="end"){this.bounds([this._bounds[0]+r.length,this._bounds[0]+r.length]);this.select()}else{if(q=="all"){this.bounds([this._bounds[0],this._bounds[0]+r.length]);this.select()}}}return this}else{return this._nativeGetText(this._nativeRange(this.bounds()))}},insertEOL:function(){this._nativeEOL();this._bounds=[this._bounds[0]+1,this._bounds[0]+1];return this}};function a(){}a.prototype=new e();a.prototype._nativeRange=function(r){var q;if(this._el.tagName=="INPUT"){q=this._el.createTextRange()}else{q=document.body.createTextRange();q.moveToElementText(this._el)}if(r){if(r[1]<0){r[1]=0}if(r[0]>this.length()){r[0]=this.length()}if(r[1]<q.text.replace(/\r/g,"").length){q.moveEnd("character",-1);q.moveEnd("character",r[1]-q.text.replace(/\r/g,"").length)}if(r[0]>0){q.moveStart("character",r[0])}}return q};a.prototype._nativeSelect=function(q){q.select()};a.prototype._nativeSelection=function(){var r=this._nativeRange();var q=this.length();if(document.selection.type!="Text"){return[q,q]}var s=document.selection.createRange();try{return[o(s,r),m(s,r)]}catch(t){return(s.parentElement().sourceIndex<this._el.sourceIndex)?[0,0]:[q,q]}};a.prototype._nativeGetText=function(q){return q.text.replace(/\r/g,"")};a.prototype._nativeSetText=function(r,q){q.text=r};a.prototype._nativeEOL=function(){if(typeof this._el.value!="undefined"){this.text("\n")}else{this._nativeRange(this.bounds()).pasteHTML("<br/>")}};function o(r,t){var q=t.text.replace(/\r/g,"").length;if(r.compareEndPoints("StartToStart",t)<=0){return 0}if(r.compareEndPoints("StartToEnd",t)>=0){return q}for(var s=0;r.compareEndPoints("StartToStart",t)>0;++s,r.moveStart("character",-1)){}return s}function m(r,t){var q=t.text.replace(/\r/g,"").length;if(r.compareEndPoints("EndToEnd",t)>=0){return q}if(r.compareEndPoints("EndToStart",t)<=0){return 0}for(var s=0;r.compareEndPoints("EndToStart",t)>0;++s,r.moveEnd("character",-1)){}return s}function l(){}l.prototype=new e();l.prototype._nativeRange=function(q){return q||[0,this.length()]};l.prototype._nativeSelect=function(q){this._el.setSelectionRange(q[0],q[1])};l.prototype._nativeSelection=function(){return[this._el.selectionStart,this._el.selectionEnd]};l.prototype._nativeGetText=function(q){return this._el.value.substring(q[0],q[1])};l.prototype._nativeSetText=function(s,q){var r=this._el.value;this._el.value=r.substring(0,q[0])+s+r.substring(q[1])};l.prototype._nativeEOL=function(){this.text("\n")};function k(){}k.prototype=new e();k.prototype._nativeRange=function(r){var q=document.createRange();q.selectNodeContents(this._el);if(r){i(q,r[0],true,this._el);q.collapse(true);i(q,r[1]-r[0],false,this._el)}return q};k.prototype._nativeSelect=function(q){window.getSelection().removeAllRanges();window.getSelection().addRange(q)};k.prototype._nativeSelection=function(){var q=this._nativeRange();if(window.getSelection().rangeCount==0){return[this.length(),this.length()]}var r=window.getSelection().getRangeAt(0);return[n(r,q),j(r,q)]};k.prototype._nativeGetText=function(q){return q.toString()};k.prototype._nativeSetText=function(r,q){q.deleteContents();q.insertNode(document.createTextNode(r));this._el.normalize()};k.prototype._nativeEOL=function(){var q=this._nativeRange(this.bounds());q.deleteContents();var r=document.createElement("br");r.setAttribute("_moz_dirty","");q.insertNode(r);q.insertNode(document.createTextNode("\n"));q.collapse(false)};function p(r,q){if(r.firstChild){return r.firstChild}if(r.nextSibling){return r.nextSibling}if(r===q){return null}while(r.parentNode){r=r.parentNode;if(r==q){return null}if(r.nextSibling){return r.nextSibling}}return null}function i(q,v,u,s){if(v<=0){return}var t=q[u?"startContainer":"endContainer"];if(t.nodeType==3){v+=q[u?"startOffset":"endOffset"]}while(t){if(t.nodeType==3){if(v<=t.nodeValue.length){q[u?"setStart":"setEnd"](t,v);if(v==t.nodeValue.length){for(var r=p(t,s);r&&r.nodeType==3&&r.nodeValue.length==0;r=p(r,s)){q[u?"setStartAfter":"setEndAfter"](r)}if(r&&r.nodeType==1&&r.nodeName=="BR"){q[u?"setStartAfter":"setEndAfter"](r)}}return}else{q[u?"setStartAfter":"setEndAfter"](t);v-=t.nodeValue.length}}t=p(t,s)}}var h=0;var c=1;var g=2;var f=3;function n(q,r){if(q.compareBoundaryPoints(h,r)<=0){return 0}if(q.compareBoundaryPoints(f,r)>=0){return r.toString().length}q=q.cloneRange();q.setEnd(r.endContainer,r.endOffset);return r.toString().length-q.toString().length}function j(q,r){if(q.compareBoundaryPoints(g,r)>=0){return r.toString().length}if(q.compareBoundaryPoints(c,r)<=0){return 0}q=q.cloneRange();q.setStart(r.startContainer,r.startOffset);return q.toString().length}function d(){}d.prototype=new e();d.prototype._nativeRange=function(q){return q||[0,this.length()]};d.prototype._nativeSelect=function(q){};d.prototype._nativeSelection=function(){return[0,0]};d.prototype._nativeGetText=function(q){return this._el[this._textProp].substring(q[0],q[1])};d.prototype._nativeSetText=function(s,q){var r=this._el[this._textProp];this._el[this._textProp]=r.substring(0,q[0])+s+r.substring(q[1])};d.prototype._nativeEOL=function(){this.text("\n")}})();