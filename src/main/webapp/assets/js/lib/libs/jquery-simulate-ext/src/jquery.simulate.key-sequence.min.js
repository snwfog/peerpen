(function(a,b){a.simulate.prototype.quirks=a.simulate.prototype.quirks||{};a.extend(a.simulate.prototype.quirks,{delayedSpacesInNonInputGlitchToEnd:b});a.extend(a.simulate.prototype,{simulateKeySequence:function(){var k=this.target,h=a(k),c=a.extend({sequence:"",triggerKeyEvents:true,delay:0,callback:b},this.options),j=c.sequence;c.delay=parseInt(c.delay,10);var l={};if(a.simulate.prototype.quirks.delayedSpacesInNonInputGlitchToEnd&&!h.is("input,textarea")){a.extend(l,{" ":function(n,o,p){var q=a.extend({},p,{triggerKeyEvents:false,delay:0,callback:b});a.simulate.prototype.simulateKeySequence.defaults.simplechar(n,"\xA0",q);a.simulate.prototype.simulateKeySequence.defaults["{leftarrow}"](n,o,q);a.simulate.prototype.simulateKeySequence.defaults.simplechar(n,o,p);a.simulate.prototype.simulateKeySequence.defaults["{del}"](n,o,q)}})}a.extend(l,c,h.data("simulate-keySequence"));var d=a.data(k,"simulate-keySequence.selection");if(!d){d=bililiteRange(k).bounds("selection");a.data(k,"simulate-keySequence.selection",d);h.bind("mouseup.simulate-keySequence",function(){a.data(k,"simulate-keySequence.selection").bounds("selection")}).bind("keyup.simulate-keySequence",function(n){if(n.which===9){a.data(k,"simulate-keySequence.selection").select()}else{a.data(k,"simulate-keySequence.selection").bounds("selection")}})}k.focus();if(typeof j==="undefined"){return}j=j.replace(/\n/g,"{enter}");function i(){h.trigger({type:"simulate-keySequence",sequence:j});if(a.isFunction(c.callback)){c.callback.apply(k,[{sequence:j}])}}function g(){var p=f()-e;if(p>=c.delay){var n=m.exec(j);if(n!==null){var o=n[0];(l[o]||a.simulate.prototype.simulateKeySequence.defaults[o]||a.simulate.prototype.simulateKeySequence.defaults.simplechar)(d,o,c);setTimeout(g,c.delay)}else{i()}e=f()}else{setTimeout(g,c.delay-p)}}if(!c.delay||c.delay<=0){j.replace(/\{[^}]*\}|[^{]+/g,function(n){(l[n]||a.simulate.prototype.simulateKeySequence.defaults[n]||a.simulate.prototype.simulateKeySequence.defaults.simplechar)(d,n,c)});i()}else{var m=/\{[^}]*\}|[^{]/g;var f=Date.now||function(){return new Date().getTime()},e=f();g()}}});a.extend(a.simulate.prototype.simulateKeySequence.prototype,{IEKeyCodeTable:{33:49,64:50,35:51,36:52,37:53,94:54,38:55,42:56,40:57,41:48,59:186,58:186,61:187,43:187,44:188,60:188,45:189,95:189,46:190,62:190,47:191,63:191,96:192,126:192,91:219,123:219,92:220,124:220,93:221,125:221,39:222,34:222},charToKeyCode:function(d){var e=a.simulate.prototype.simulateKeySequence.prototype.IEKeyCodeTable;var c=d.charCodeAt(0);if(c>=64&&c<=90||c>=48&&c<=57){return c}else{if(c>=97&&c<=122){return d.toUpperCase().charCodeAt(0)}else{if(e[c]!==b){return e[c]}else{return c}}}}});a.simulate.prototype.simulateKeySequence.defaults={simplechar:function(d,f,g){d.text(f,"end");if(g.triggerKeyEvents){for(var e=0;e<f.length;e+=1){var c=f.charCodeAt(e);var h=a.simulate.prototype.simulateKeySequence.prototype.charToKeyCode(f.charAt(e));a(d._el).simulate("keydown",{keyCode:h});a(d._el).simulate("keypress",{keyCode:c,which:c,charCode:c});a(d._el).simulate("keyup",{keyCode:h})}}},"{{}":function(c,d,e){a.simulate.prototype.simulateKeySequence.defaults.simplechar(c,"{",e)},"{enter}":function(c,d,e){c.insertEOL();c.select();if(e.triggerKeyEvents===true){a(c._el).simulate("keydown",{keyCode:13});a(c._el).simulate("keypress",{keyCode:13,which:13,charCode:13});a(c._el).simulate("keyup",{keyCode:13})}},"{backspace}":function(d,e,f){var c=d.bounds();if(c[0]===c[1]){d.bounds([c[0]-1,c[0]])}d.text("","end");if(f.triggerKeyEvents===true){a(d._el).simulate("keydown",{keyCode:8});a(d._el).simulate("keyup",{keyCode:8})}},"{del}":function(d,e,f){var c=d.bounds();if(c[0]===c[1]){d.bounds([c[0],c[0]+1])}d.text("","end");if(f.triggerKeyEvents===true){a(d._el).simulate("keydown",{keyCode:46});a(d._el).simulate("keyup",{keyCode:46})}},"{rightarrow}":function(d,e,f){var c=d.bounds();if(c[0]===c[1]){c[1]+=1}d.bounds([c[1],c[1]]).select();if(f.triggerKeyEvents===true){a(d._el).simulate("keydown",{keyCode:39});a(d._el).simulate("keyup",{keyCode:39})}},"{leftarrow}":function(d,e,f){var c=d.bounds();if(c[0]===c[1]){c[0]-=1}d.bounds([c[0],c[0]]).select();if(f.triggerKeyEvents===true){a(d._el).simulate("keydown",{keyCode:37});a(d._el).simulate("keyup",{keyCode:37})}},"{selectall}":function(c){c.bounds("all").select()}};if(a.simulate.ext_disableQuirkDetection!==true){a(document).ready(function(){var c=a("<div/>").css({height:1,width:1,position:"absolute",left:-1000,top:-1000}).appendTo("body");c.simulate("key-sequence",{sequence:"\xA0 \xA0",delay:1,callback:function(){a.simulate.prototype.quirks.delayedSpacesInNonInputGlitchToEnd=(c.text().indexOf(" ")>1);c.remove()}})})}})(jQuery);