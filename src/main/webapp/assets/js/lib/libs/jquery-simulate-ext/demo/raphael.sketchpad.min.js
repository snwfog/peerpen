(function(b){b.sketchpad=function(g,f){return new d(g,f)};b.sketchpad.VERSION="0.5.1";var d=function(r,m){var w=this;var x={width:100,height:100,strokes:[],editing:true};jQuery.extend(x,m);var f;if(r.raphael&&r.raphael.constructor==b.constructor){f=r}else{if(typeof r=="string"){f=b(r,x.width,x.height)}else{throw"first argument must be a Raphael object, an element ID, an array with 3 elements"}}var t=f.canvas;var q=$(t).parent();var k=new a();w.paper=function(){return f};w.canvas=function(){return t};w.container=function(){return q};w.pen=function(D){if(D===undefined){return k}k=D;return w};function s(F){var G="";for(var E=0,H=F.length;E<H;E++){var D=F[E];G+=D[0]+D[1]+","+D[2]}return G}function p(I){var H=[];var G=I.split("L");if(G.length>0){var E=G[0].replace("M","");var F=E.split(",");H.push(["M",parseInt(F[0]),parseInt(F[1])]);for(var D=1,J=G.length;D<J;D++){E=G[D];F=E.split(",");H.push(["L",parseInt(F[0]),parseInt(F[1])])}}return H}w.json=function(E){if(E===undefined){for(var D=0,G=n.length;D<G;D++){var F=n[D];if(typeof F.path=="object"){F.path=s(F.path)}}return JSON.stringify(n)}return w.strokes(JSON.parse(E))};w.strokes=function(E){if(E===undefined){return n}if(jQuery.isArray(E)){n=E;for(var D=0,G=n.length;D<G;D++){var F=n[D];if(typeof F.path=="string"){F.path=p(F.path)}}j.add({type:"batch",strokes:jQuery.merge([],n)});B();u()}return w};w.freeze_history=function(){j.freeze()};w.undoable=function(){return j.undoable()};w.undo=function(){if(j.undoable()){j.undo();n=j.current_strokes();B();u()}return w};w.redoable=function(){return j.redoable()};w.redo=function(){if(j.redoable()){j.redo();n=j.current_strokes();B();u()}return w};w.clear=function(){j.add({type:"clear"});n=[];B();u();return w};w.animate=function(E){if(E===undefined){E=500}f.clear();if(n.length>0){var F=0;function D(){var H=n[F];var G=H.type;f[G]().attr(H).click(v);F++;if(F<n.length){setTimeout(D,E)}}D()}return w};w.editing=function(E){if(E===undefined){return x.editing}x.editing=E;if(x.editing){if(x.editing=="erase"){$(q).css("cursor","crosshair");$(q).unbind("mousedown",g);$(q).unbind("mousemove",o);$(q).unbind("mouseup",l);$(document).unbind("mouseup",l);var D=navigator.userAgent;if(D.indexOf("iPhone")>0||D.indexOf("iPod")>0){$(q).unbind("touchstart",z);$(q).unbind("touchmove",C);$(q).unbind("touchend",h)}}else{$(q).css("cursor","crosshair");$(q).mousedown(g);$(q).mousemove(o);$(q).mouseup(l);$(document).mouseup(l);var D=navigator.userAgent;if(D.indexOf("iPhone")>0||D.indexOf("iPod")>0){$(q).bind("touchstart",z);$(q).bind("touchmove",C);$(q).bind("touchend",h)}}}else{$(q).attr("style","cursor:default");$(q).unbind("mousedown",g);$(q).unbind("mousemove",o);$(q).unbind("mouseup",l);$(document).unbind("mouseup",l);var D=navigator.userAgent;if(D.indexOf("iPhone")>0||D.indexOf("iPod")>0){$(q).unbind("touchstart",z);$(q).unbind("touchmove",C);$(q).unbind("touchend",h)}}return w};var y=function(){};w.change=function(D){if(D==null||D===undefined){y=function(){}}else{if(typeof D=="function"){y=D}}};function u(){y()}function B(){f.clear();for(var D=0,G=n.length;D<G;D++){var F=n[D];var E=F.type;f[E]().attr(F).click(v)}}function i(){$("*").css("-webkit-user-select","none");$("*").css("-moz-user-select","none");if(!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase())){$("body").attr("onselectstart","return false;")}}function A(){$("*").css("-webkit-user-select","text");$("*").css("-moz-user-select","text");if(!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase())){$("body").removeAttr("onselectstart")}}function v(G){if(x.editing=="erase"){var F=this.attr();F.type=this.type;j.add({type:"erase",stroke:F});for(var D=0,H=n.length;D<H;D++){var E=n[D];if(equiv(E,F)){n.splice(D,1)}}u();this.remove()}}function g(D){i();k.start(D,w)}function o(D){k.move(D,w)}function l(F){A();var E=k.finish(F,w);if(E!=null){E.click(v);var D=E.attr();D.type=E.type;n.push(D);j.add({type:"stroke",stroke:D});u()}}function z(D){D=D.originalEvent;D.preventDefault();if(D.touches.length==1){var E=D.touches[0];g(E)}}function C(D){D=D.originalEvent;D.preventDefault();if(D.touches.length==1){var E=D.touches[0];o(E)}}function h(D){D=D.originalEvent;D.preventDefault();l(D)}var j=new c();var n=x.strokes;if(jQuery.isArray(n)&&n.length>0){j.add({type:"init",strokes:jQuery.merge([],n)});B()}else{n=[];B()}w.editing(x.editing)};var c=function(){var g=this;var h=[];var f=-1;var j=-1;var i=null;g.add=function(k){if(f+1<h.length){h.splice(f+1,h.length-(f+1))}h.push(k);f=h.length-1;i=null};g.freeze=function(k){if(k===undefined){j=f}else{j=k}};g.undoable=function(){return(f>-1&&f>j)};g.undo=function(){if(g.undoable()){f--;i=null}};g.redoable=function(){return f<h.length-1};g.redo=function(){if(g.redoable()){f++;i=null}};g.current_strokes=function(){if(i==null){var k=[];for(var l=0;l<=f;l++){var o=h[l];switch(o.type){case"init":case"json":case"strokes":case"batch":jQuery.merge(k,o.strokes);break;case"stroke":k.push(o.stroke);break;case"erase":for(var m=0,q=k.length;m<q;m++){var p=k[m];if(equiv(p,o.stroke)){k.splice(m,1)}}break;case"clear":k=[];break}}i=k}return i}};var a=function(){var n=this;var j="#000000";var i=1;var g=5;var m=null;var l=false;var k=null;var h=[];n.color=function(o){if(o===undefined){return j}j=o;return n};n.width=function(o){if(o===undefined){return g}if(o<a.MIN_WIDTH){o=a.MIN_WIDTH}else{if(o>a.MAX_WIDTH){o=a.MAX_WIDTH}}g=o;return n};n.opacity=function(o){if(o===undefined){return i}if(o<0){o=0}else{if(o>1){o=1}}i=o;return n};n.start=function(q,p){l=true;m=$(p.container()).offset();var o=q.pageX-m.left,r=q.pageY-m.top;h.push([o,r]);k=p.paper().path();k.attr({stroke:j,"stroke-opacity":i,"stroke-width":g,"stroke-linecap":"round","stroke-linejoin":"round"})};n.finish=function(q,o){var p=null;if(k!=null){if(h.length<=1){k.remove()}else{p=k}}l=false;k=null;h=[];return p};n.move=function(q,p){if(l==true){var o=q.pageX-m.left,r=q.pageY-m.top;h.push([o,r]);k.attr({path:f()})}};function f(){if(h!=null&&h.length>1){var r=h[0];var q="M"+r[0]+","+r[1];for(var o=1,s=h.length;o<s;o++){r=h[o];q+="L"+r[0]+","+r[1]}return q}else{return""}}};a.MAX_WIDTH=1000;a.MIN_WIDTH=1;function e(g){var h="";for(var f in g){h+=f+"="+g[f]+"\n"}return h}})(window.Raphael);Raphael.fn.display=function(c){for(var a=0,f=c.length;a<f;a++){var d=c[a];var b=d.type;this[b]().attr(d)}};function hoozit(a){if(a.constructor===String){return"string"}else{if(a.constructor===Boolean){return"boolean"}else{if(a.constructor===Number){if(isNaN(a)){return"nan"}else{return"number"}}else{if(typeof a==="undefined"){return"undefined"}else{if(a===null){return"null"}else{if(a instanceof Array){return"array"}else{if(a instanceof Date){return"date"}else{if(a instanceof RegExp){return"regexp"}else{if(typeof a==="object"){return"object"}else{if(a instanceof Function){return"function"}else{return undefined}}}}}}}}}}}function bindCallbacks(c,b,a){var d=hoozit(c);if(d){if(hoozit(b[d])==="function"){return b[d].apply(b,a)}else{return b[d]}}}var equiv=function(){var b;var c=[];var a=function(){function d(e,f){if(e instanceof f.constructor||f instanceof e.constructor){return f==e}else{return f===e}}return{string:d,"boolean":d,number:d,"null":d,"undefined":d,nan:function(e){return isNaN(e)},date:function(e,f){return hoozit(e)==="date"&&f.valueOf()===e.valueOf()},regexp:function(e,f){return hoozit(e)==="regexp"&&f.source===e.source&&f.global===e.global&&f.ignoreCase===e.ignoreCase&&f.multiline===e.multiline},"function":function(){var e=c[c.length-1];return e!==Object&&typeof e!=="undefined"},array:function(f,g){var h;var e;if(!(hoozit(f)==="array")){return false}e=g.length;if(e!==f.length){return false}for(h=0;h<e;h++){if(!b(g[h],f[h])){return false}}return true},object:function(f,g){var j;var e=true;var h=[],k=[];if(g.constructor!==f.constructor){return false}c.push(g.constructor);for(j in g){h.push(j);if(!b(g[j],f[j])){e=false}}c.pop();for(j in f){k.push(j)}return e&&b(h.sort(),k.sort())}}}();b=function(){var d=Array.prototype.slice.apply(arguments);if(d.length<2){return true}return(function(f,e){if(f===e){return true}else{if(f===null||e===null||typeof f==="undefined"||typeof e==="undefined"||hoozit(f)!==hoozit(e)){return false}else{return bindCallbacks(f,a,[e,f])}}})(d[0],d[1])&&arguments.callee.apply(this,d.splice(1,d.length-1))};return b}();