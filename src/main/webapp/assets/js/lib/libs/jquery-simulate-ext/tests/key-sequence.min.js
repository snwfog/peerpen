(function(a,b){a(document).ready(function(){module("key-sequence",{setup:function(){tests.testSetup();a(document).on("simulate-keySequence","#qunit-fixture",tests.assertExpectedEvent)},teardown:function(){a(document).off("simulate-keySequence","#qunit-fixture");tests.testTearDown()}});test("simple sequence",function(){var d=a("#textInput");var c="fO0BaR1";tests.expectedEvents=[{type:"keydown",keyCode:70},{type:"keypress",which:"f".charCodeAt(0)},{type:"keyup",keyCode:70},{type:"keydown",keyCode:79},{type:"keypress",which:"O".charCodeAt(0)},{type:"keyup",keyCode:79},{type:"keydown",keyCode:48},{type:"keypress",which:"0".charCodeAt(0)},{type:"keyup",keyCode:48},{type:"keydown",keyCode:66},{type:"keypress",which:"B".charCodeAt(0)},{type:"keyup",keyCode:66},{type:"keydown",keyCode:65},{type:"keypress",which:"a".charCodeAt(0)},{type:"keyup",keyCode:65},{type:"keydown",keyCode:82},{type:"keypress",which:"R".charCodeAt(0)},{type:"keyup",keyCode:82},{type:"keydown",keyCode:49},{type:"keypress",which:"1".charCodeAt(0)},{type:"keyup",keyCode:49},{type:"simulate-keySequence",sequence:c}];d.simulate("key-sequence",{sequence:c});strictEqual(d.val(),c,"Verify result of sequence")});test("sequence callback",function(){var d=a("#textInput");var c="test";tests.expectedEvents=[{type:"keydown",keyCode:84},{type:"keypress",which:"t".charCodeAt(0)},{type:"keyup",keyCode:84},{type:"keydown",keyCode:69},{type:"keypress",which:"e".charCodeAt(0)},{type:"keyup",keyCode:69},{type:"keydown",keyCode:83},{type:"keypress",which:"s".charCodeAt(0)},{type:"keyup",keyCode:83},{type:"keydown",keyCode:84},{type:"keypress",which:"t".charCodeAt(0)},{type:"keyup",keyCode:84},{type:"simulate-keySequence",sequence:c},{type:"callback"}];d.simulate("key-sequence",{sequence:c,callback:function(){tests.assertExpectedEvent({type:"callback"})}})});test("no events",function(){var d=a("#textInput");var c="fO0BaR1";tests.expectedEvents=[{type:"simulate-keySequence",sequence:c}];d.simulate("key-sequence",{sequence:c,triggerKeyEvents:false});strictEqual(d.val(),c,"Verify result of sequence")});test("special characters",function(){var d=a("#textInput");var c="_-.,;:+!?";tests.expectedEvents=[{type:"keydown",keyCode:189},{type:"keypress",which:"_".charCodeAt(0)},{type:"keyup",keyCode:189},{type:"keydown",keyCode:189},{type:"keypress",which:"-".charCodeAt(0)},{type:"keyup",keyCode:189},{type:"keydown",keyCode:190},{type:"keypress",which:".".charCodeAt(0)},{type:"keyup",keyCode:190},{type:"keydown",keyCode:188},{type:"keypress",which:",".charCodeAt(0)},{type:"keyup",keyCode:188},{type:"keydown",keyCode:186},{type:"keypress",which:";".charCodeAt(0)},{type:"keyup",keyCode:186},{type:"keydown",keyCode:186},{type:"keypress",which:":".charCodeAt(0)},{type:"keyup",keyCode:186},{type:"keydown",keyCode:187},{type:"keypress",which:"+".charCodeAt(0)},{type:"keyup",keyCode:187},{type:"keydown",keyCode:49},{type:"keypress",which:"!".charCodeAt(0)},{type:"keyup",keyCode:49},{type:"keydown",keyCode:191},{type:"keypress",which:"?".charCodeAt(0)},{type:"keyup",keyCode:191},{type:"simulate-keySequence",sequence:c}];d.simulate("key-sequence",{sequence:c})});test("special sequences",function(){var d=a("#textInput");var c="as{selectall}{del}f{leftarrow}{{}b{rightarrow}{backspace}";tests.expectedEvents=[{type:"keydown",keyCode:65},{type:"keypress",which:"a".charCodeAt(0)},{type:"keyup",keyCode:65},{type:"keydown",keyCode:83},{type:"keypress",which:"s".charCodeAt(0)},{type:"keyup",keyCode:83},{type:"keydown",keyCode:46},{type:"keyup",keyCode:46},{type:"keydown",keyCode:70},{type:"keypress",which:"f".charCodeAt(0)},{type:"keyup",keyCode:70},{type:"keydown",keyCode:37},{type:"keyup",keyCode:37},{type:"keydown",keyCode:219},{type:"keypress",which:"{".charCodeAt(0)},{type:"keyup",keyCode:219},{type:"keydown",keyCode:66},{type:"keypress",which:"b".charCodeAt(0)},{type:"keyup",keyCode:66},{type:"keydown",keyCode:39},{type:"keyup",keyCode:39},{type:"keydown",keyCode:8},{type:"keyup",keyCode:8},{type:"simulate-keySequence",sequence:c}];d.simulate("key-sequence",{sequence:c});strictEqual(d.val(),"{b","Verify result of sequence (this is known to fail in IE)")});test("line break",function(){var d=a("#textInput");var c="foo{enter}bar";tests.expectedEvents=[{type:"keydown",keyCode:70},{type:"keypress",which:"f".charCodeAt(0)},{type:"keyup",keyCode:70},{type:"keydown",keyCode:79},{type:"keypress",which:"o".charCodeAt(0)},{type:"keyup",keyCode:79},{type:"keydown",keyCode:79},{type:"keypress",which:"o".charCodeAt(0)},{type:"keyup",keyCode:79},{type:"keydown",keyCode:13},{type:"keypress",which:13},{type:"keyup",keyCode:13},{type:"keydown",keyCode:66},{type:"keypress",which:"b".charCodeAt(0)},{type:"keyup",keyCode:66},{type:"keydown",keyCode:65},{type:"keypress",which:"a".charCodeAt(0)},{type:"keyup",keyCode:65},{type:"keydown",keyCode:82},{type:"keypress",which:"r".charCodeAt(0)},{type:"keyup",keyCode:82},{type:"simulate-keySequence",sequence:c}];d.simulate("key-sequence",{sequence:c});strictEqual(d.val(),"foo\nbar","Verify result of sequence (this is known to fail in Opera on Windows)")});test("delay",function(){var f=a("#textInput");var d=100,c="test",g;tests.expectedEvents=[{type:"keydown",keyCode:84},{type:"keypress",which:"t".charCodeAt(0)},{type:"keyup",keyCode:84},{type:"keydown",keyCode:69},{type:"keypress",which:"e".charCodeAt(0)},{type:"keyup",keyCode:69},{type:"keydown",keyCode:83},{type:"keypress",which:"s".charCodeAt(0)},{type:"keyup",keyCode:83},{type:"keydown",keyCode:84},{type:"keypress",which:"t".charCodeAt(0)},{type:"keyup",keyCode:84},{type:"simulate-keySequence",sequence:c}];function e(i){var h=Date.now()-g;ok(h>=d-10,"Verify events occur delayed (delay: "+h+")");for(var j in tests.expectedEvents[0]){if(tests.expectedEvents[0].hasOwnProperty(j)){strictEqual(i[j],tests.expectedEvents[0][j],"Comparing "+j+" (expected: "+tests.expectedEvents[0][j]+")")}}if(i.type===tests.expectedEvents[0].type){tests.expectedEvents.shift()}g=Date.now()}a(document).off("keydown","#qunit-fixture",tests.assertExpectedEvent).on("keydown","#qunit-fixture",e);stop();g=Date.now()-d;f.simulate("key-sequence",{sequence:c,delay:d});setTimeout(function(){start()},(c.length+2)*d)});test("delay, spaces in sequence, non-input element",function(){var e=a("#emptyDiv");var d=5,c="a b c";tests.expectedEvents=[{type:"keydown",keyCode:65},{type:"keypress",which:"a".charCodeAt(0)},{type:"keyup",keyCode:65},{type:"keydown",keyCode:32},{type:"keypress",which:" ".charCodeAt(0)},{type:"keyup",keyCode:32},{type:"keydown",keyCode:66},{type:"keypress",which:"b".charCodeAt(0)},{type:"keyup",keyCode:66},{type:"keydown",keyCode:32},{type:"keypress",which:" ".charCodeAt(0)},{type:"keyup",keyCode:32},{type:"keydown",keyCode:67},{type:"keypress",which:"c".charCodeAt(0)},{type:"keyup",keyCode:67},{type:"simulate-keySequence",sequence:c}];stop();e.simulate("key-sequence",{sequence:c,delay:d,callback:function(){strictEqual(e.text(),c,"Verify result of sequence");start()}})});module("quirk-detection",{});asyncTest("quirk detection",1,function(){setTimeout(function(){var h=window.frames[0].document;var d=h.createElement("script");d.src="../libs/jquery-1.10.2.js";h.body.appendChild(d);var g=h.createElement("script");g.src="../libs/bililiteRange.js";h.body.appendChild(g);var e=h.createElement("script");e.src="../libs/jquery.simulate.js";h.body.appendChild(e);var f=h.createElement("script");f.src="../src/jquery.simulate.ext.js";h.body.appendChild(f);var c=h.createElement("script");c.src="../src/jquery.simulate.key-sequence.js";h.body.appendChild(c);setTimeout(function(){notStrictEqual(window.frames[0].jQuery.simulate.prototype.quirks.delayedSpacesInNonInputGlitchToEnd,b,"Quirk detection was executed");start()},2000)},1000)});asyncTest("disable quirk detection",1,function(){setTimeout(function(){var f=window.frames[0].document;var c=f.createElement("script");c.src="../libs/jquery-1.10.2.js";f.body.appendChild(c);var e=f.createElement("script");e.src="../libs/bililiteRange.js";f.body.appendChild(e);var d=f.createElement("script");d.src="../libs/jquery.simulate.js";f.body.appendChild(d);setTimeout(function(){window.frames[0].jQuery.simulate.ext_disableQuirkDetection=true;var h=f.createElement("script");h.src="../src/jquery.simulate.ext.js";f.body.appendChild(h);var g=f.createElement("script");g.src="../src/jquery.simulate.key-sequence.js";f.body.appendChild(g);setTimeout(function(){strictEqual(window.frames[0].jQuery.simulate.prototype.quirks.delayedSpacesInNonInputGlitchToEnd,b,"Quirk detection was disabled");start()},2000)},2000)},1000)})})}(jQuery));