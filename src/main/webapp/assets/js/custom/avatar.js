// Generated by CoffeeScript 1.3.3
var showPreview;

Dropzone.autoDiscover = false;

showPreview = function(coords) {
  var $original, $preview, $previewContainer, originalHeight, originalWidth, previewHeight, previewWidth, rx, ry;
  $preview = $('div#avatar-preview-container img');
  $previewContainer = $('div#avatar-preview-container');
  previewHeight = $previewContainer.height();
  previewWidth = $previewContainer.width();
  $original = $('div.dz-preview img:first');
  originalHeight = $original.height();
  originalWidth = $original.width();
  rx = previewWidth / coords.w;
  ry = previewHeight / coords.h;
  $preview.css({
    width: Math.round(rx * originalWidth) + 'px',
    height: Math.round(ry * originalHeight) + 'px',
    marginLeft: '-' + Math.round(rx * coords.x) + 'px',
    marginTop: '-' + Math.round(ry * coords.y) + 'px'
  });
  $('input#avatar-crop-x1').val(coords.x);
  $('input#avatar-crop-x2').val(coords.x2);
  $('input#avatar-crop-y1').val(coords.y);
  $('input#avatar-crop-y2').val(coords.y2);
  $('input#avatar-crop-width').val(coords.w);
  return $('input#avatar-crop-height').val(coords.h);
};

Dropzone.options.avatarUpload = {
  maxFilesize: 3,
  autoProcessQueue: false,
  maxFiles: 1,
  thumbnailWidth: 512,
  thumbnailHeight: 512,
  acceptedFiles: 'image/*',
  uploadMultiple: false,
  accept: function(file, done) {
    console.log("Uploaded");
    return done();
  },
  init: function() {
    this.on("maxfilesexceeded", function(file) {
      return console.log("Reached limit" + file.name);
    });
    this.on("addedfile", function(file) {
      console.log("" + file.name + " added");
      if (this.files.length > 1) {
        return this.removeFile(this.files[0]);
      }
    });
    return this.on("thumbnail", function(file, dataURI) {
      var $original, $preview;
      $preview = $('img#avatar-preview').attr('src', dataURI);
      $original = $('div.dz-preview img');
      return $original.Jcrop({
        bgColor: 'rgba(0, 0, 0, 0.4)',
        bgOpacity: 1,
        setSelect: [0, 0, 50, 50],
        aspectRatio: 1,
        onSelect: showPreview,
        onChange: showPreview
      });
    });
  }
};

$(function() {
  var avatarDropzone;
  avatarDropzone = new Dropzone('#avatar-upload');
  console.log("avatar.min.js");
  return $("#avatar-upload button").click(function() {
    return avatarDropzone.processQueue();
  });
});
